<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>åƒä»€ä¹ˆå‘¢å¤§è½¬ç›˜</title>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="eat-wheel-icon.png" type="image/png">
  <style>
    body {
      font-family: 'Noto Sans SC', sans-serif;
      background: #fffaf0;
      color: #333;
      text-align: center;
      padding: 1rem;
    }

    h1 {
      font-size: 2.5rem;
      letter-spacing: 1px;
      margin-bottom: 1rem;
    }

    h2 {
      font-size: 1.6rem;
      margin-top: 2rem;
    }

    input, button, textarea {
      margin: 0.5rem;
      padding: 0.6rem;
      font-size: 1rem;
      border-radius: 12px;
      border: 1px solid #ccc;
      font-family: 'Noto Sans SC', sans-serif;
      background: #fff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    button {
      background-color: #ffcc66;
      border: none;
      cursor: pointer;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      transition: all 0.2s ease;
    }

    button:hover {
      background-color: #ffb84d;
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }

    button:active {
      transform: scale(0.96);
    }

    select {
      margin: 0.5rem;
      padding: 0.6rem;
      padding-right: 2.2rem; /* è®©æ–‡å­—å’Œä¸‹æ‹‰ç®­å¤´ä¸æŒ¤ */
      font-size: 1rem;
      border-radius: 12px;
      border: 1px solid #ccc;
      font-family: 'Noto Sans SC', sans-serif;
      background: #fff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);

      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      background-image: url('data:image/svg+xml;utf8,<svg fill="black" height="14" viewBox="0 0 24 24" width="14" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
      background-repeat: no-repeat;
      background-position: right 0.8rem center;
      background-size: 1rem;
    }

    select:hover {
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }

    select:focus {
      outline: none;
      border-color: #ffb84d;
      box-shadow: 0 0 0 3px rgba(255,184,77,0.3);
    }

    #wheelCanvas {
      margin: 1rem auto;
      display: block;
      border: 6px solid #555;
      border-radius: 50%;
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    }

    #resultDisplay-wrapper {
      text-align: center;
      margin-top: 1rem;
    }

    #resultDisplay {
      display: inline-block;
      font-size: 1.6rem;
      font-weight: bold;
      color: #eb596e;
      background: #fff3f3;
      padding: 0.6rem 1rem;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    #resultDisplay:empty {
      background: transparent;
      box-shadow: none;
      padding: 0;
    }
  </style>
</head>
<body>
  <h1>ğŸ¡ ä»Šå¤©åƒä»€ä¹ˆï¼Ÿ</h1>
  <select id="category">
    <option value="company">åœ¨å…¬å¸åƒä»€ä¹ˆ</option>
    <option value="home">ç‚¹ä»€ä¹ˆå¤–å–å‘¢</option>
    <option value="quickhome">æ‡’äººé€Ÿé£Ÿé€‰ä»€ä¹ˆ</option>
    <option value="dessert">ç”œç‚¹åƒä»€ä¹ˆ</option>
    <option value="cook">ä»Šå¤©åšä»€ä¹ˆé¥­</option>
    <option value="custom">è‡ªå®šä¹‰è¾“å…¥</option>
  </select><br>

  <div id="customInput" style="display:none">
    <textarea id="customText" rows="2" cols="40" placeholder="ç”¨ä¸­æ–‡é€—å·åˆ†éš”ï¼šç‚¸é¸¡ï¼Œæ±‰å ¡..."></textarea><br>
  </div>

  <canvas id="wheelCanvas" width="300" height="300"></canvas><br>
  <button onclick="spinWheel()">å¼€å§‹è½¬ï¼</button>
  <button onclick="spinAnother()">æ¢ä¸€ä¸ª</button>

  <div id="resultDisplay-wrapper">
    <div id="resultDisplay"></div>
  </div>

  <hr style="margin: 2rem 0;">

  <h2>ğŸ³ æ ¹æ®å†°ç®±é£Ÿæç”Ÿæˆèœè°±</h2>
  <input id="ingredientsInput" type="text" placeholder="ä¾‹å¦‚ï¼šé¸¡è›‹ï¼Œè¥¿çº¢æŸ¿ï¼Œç±³é¥­" size="40"><br>
  <button onclick="generateRecipe()">ç”Ÿæˆæ¨è</button>
  <div id="recipeResult" style="margin-top:1rem; font-weight:bold;"></div>

<script>
  const menus = {
    company: ["ç‚¸é¸¡", "bowl", "ç™½äººé¥­", "sandwich", "sushi", "éº¦å½“å½“"],
    home: ["ç‚’ç²‰ç‚’é¢", "æ¹–å—å°ç‚’", "å››å·å°ç‚’", "ç±³ç²‰ç±³çº¿", "çƒ§çƒ¤", "éŸ©é¤", "pho", "ç‚¸é¸¡æ±‰å ¡", "salad", "ç²¥", "ç…²ä»”é¥­", "éº»è¾£çƒ«", "è‡ªå·±åŠ¨æ‰‹å§"],
    quickhome: ["æ³¡é¢", "èºè›³ç²‰", "é€Ÿå†»é¥ºå­", "ç…®ç±³çº¿", "æ‰‹æŠ“é¥¼"],
    dessert: ["å–œèŒ¶", "æ˜Ÿå·´å…‹", "å°è›‹ç³•", "æ¨æç”˜éœ²", "å¥¶èŒ¶", "æ°´æœæ"],
    cook: ["ç•ªèŒ„ç‚’è›‹", "è’¸é¸¡è›‹", "è¥¿è‘«èŠ¦ç‚’ç‰›è‚‰", "ç•ªèŒ„è‚‰æ²«è±†è…", "æµ·å—é¸¡", "è¥¿çº¢æŸ¿ç‰›è…©", "çº¢çƒ§é¸¡è‚‰", "è±†è…è™¾ä»æ±¤", "é’æ¤’ç‰›è‚‰", "é»‘æ¤’ç‰›è‚‰è˜‘è‡", "ç‰›è‚‰don", "å’–å–±"]
  };

  const canvas = document.getElementById("wheelCanvas");
  const ctx = canvas.getContext("2d");
  const categorySelect = document.getElementById('category');
  const customInput = document.getElementById('customInput');
  const customText = document.getElementById('customText');
  const resultDisplay = document.getElementById('resultDisplay');

  let currentOptions = [];
  let currentAngle = 0;

  categorySelect.addEventListener('change', () => {
    customInput.style.display = (categorySelect.value === 'custom') ? 'block' : 'none';
    if (categorySelect.value !== 'custom') {
      currentOptions = menus[categorySelect.value];
      drawWheel(currentOptions);
    }
    resultDisplay.innerText = "";
    resultDisplay.style.background = "transparent";
  });

  function drawWheel(options) {
    const total = options.length;
    const angle = (2 * Math.PI) / total;
    const dpr = window.devicePixelRatio || 1;
    canvas.width = 300 * dpr;
    canvas.height = 300 * dpr;
    ctx.setTransform(1, 0, 0, 1, 0, 0);
    ctx.scale(dpr, dpr);
    ctx.clearRect(0, 0, 300, 300);

    const COLORS = ["#f6c90e", "#eb596e", "#6a67ce", "#f79d65", "#4ecdc4", "#ff6b6b", "#48bfe3", "#9d4edd"];
    for (let i = 0; i < total; i++) {
      ctx.beginPath();
      ctx.fillStyle = COLORS[i % COLORS.length];
      ctx.moveTo(150, 150);
      ctx.arc(150, 150, 150, i * angle, (i + 1) * angle);
      ctx.lineTo(150, 150);
      ctx.fill();

      ctx.save();
      ctx.translate(150, 150);
      ctx.rotate(i * angle + angle / 2);
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.fillStyle = "#fff";
      ctx.font = "16px 'Noto Sans SC', sans-serif";
      ctx.fillText(options[i], 90, 0);
      ctx.restore();
    }
  }

  function spinWheel() {
    if (categorySelect.value === 'custom') {
      const text = customText.value.trim();
      if (!text) return alert("è¯·è¾“å…¥è‡ªå®šä¹‰å†…å®¹");
      currentOptions = text.split('ï¼Œ');
    } else {
      currentOptions = menus[categorySelect.value];
    }
    drawWheel(currentOptions);
    spinAnimation();
  }

  function spinAnother() {
    if (!currentOptions || currentOptions.length === 0) return;
    spinAnimation();
  }

  function spinAnimation() {
    const anglePerSlice = 360 / currentOptions.length;
    const stopIndex = Math.floor(Math.random() * currentOptions.length);
    const stopAngle = stopIndex * anglePerSlice;
    const targetAngle = 360 * 5 + (360 - stopAngle - anglePerSlice / 2);
    let start = null;
    const duration = 2000;
    function animate(timestamp) {
      if (!start) start = timestamp;
      const progress = timestamp - start;
      const eased = 1 - Math.pow(1 - progress / duration, 3);
      currentAngle = eased * targetAngle;
      canvas.style.transform = `rotate(${currentAngle}deg)`;
      if (progress < duration) {
        requestAnimationFrame(animate);
      } else {
        resultDisplay.innerText = `ğŸ¯ ä»Šå¤©åƒï¼š${currentOptions[stopIndex]}`;
        resultDisplay.style.background = "#fff3f3";
      }
    }
    requestAnimationFrame(animate);
  }

  function generateRecipe() {
    const ingredients = document.getElementById("ingredientsInput").value.trim();
    const resultBox = document.getElementById("recipeResult");
    if (!ingredients) return alert("è¯·è¾“å…¥é£Ÿæ");

    resultBox.innerText = "ç”Ÿæˆä¸­...";

    fetch("/api/recipe", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ ingredients })
    })
    .then(async (res) => {
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const data = await res.json();
      console.log("ğŸ§ª å‰ç«¯æ‹¿åˆ°æ•°æ®:", data);
      if (data.reply) {
        resultBox.innerText = data.reply;
        resultBox.style.background = "#fff3f3";
      } else {
        resultBox.innerText = "âŒ æ— èœè°±å†…å®¹";
        resultBox.style.background = "transparent";
      }
    })
    .catch(err => {
      console.error("âŒ fetch å‡ºé”™:", err);
      resultBox.innerText = "âŒ è¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–é‡æ–°ç”Ÿæˆ";
      resultBox.style.background = "transparent";
    });
  }

  window.onload = () => {
    currentOptions = menus["company"]; 
    drawWheel(currentOptions);
    resultDisplay.style.background = "transparent";
  }
</script>
</body>
</html>
